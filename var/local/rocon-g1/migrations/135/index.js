"use strict";var exec=require("child_process").exec,fs=require("fs"),util=require("util"),path=require("path"),rebootSchedulerSettings=require("../../config/settings.json"),newRoconDir="/var/local/rocon-g1.tmp",crontabsDir="/var/spool/cron/crontabs",crontabsDirAngstrom="/var/spool/cron",rebootSettingsPath=path.join(newRoconDir,"/config/settings.json");module.exports=function(a){exec("cat /proc/version",{},function(b,c){if(b)return a(b);var d=c.toLowerCase();-1===d.indexOf("debian")&&(crontabsDir=crontabsDirAngstrom),exec(util.format("/bin/mkdir -p %s",crontabsDir),{},function(b){return b?a(b):void exec(util.format("/bin/cp -f %s/root %s/root",__dirname,crontabsDir),{},a)})}),rebootSchedulerSettings.rebootMonth=Math.floor(5*Math.random()+4),fs.writeFileSync(rebootSettingsPath,JSON.stringify(rebootSchedulerSettings),"UTF8",function(b){return b?a(b):void 0}),fs.chmodSync(path.join(newRoconDir,"/scheduler/reboot/run.sh"),"770"),fs.chmodSync(path.join(newRoconDir,"/monitoring/network-interfaces/run.sh"),"770"),fs.chmodSync(path.join(newRoconDir,"/monitoring/logger-request/run.sh"),"770")};