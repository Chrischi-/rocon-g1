var _=require("underscore"),async=require("async"),exec=require("child_process").exec,https=require("https"),LoggerInformation=require("../../../logging/LoggerInformation.js"),logger=require("../../../config/logger");"dev"===process.env.NODE_ENV&&(https.globalAgent.options.rejectUnauthorized=!1);var NetworkInterfaces=function(){_.bindAll(this)};NetworkInterfaces.prototype.run=function(){var a=new LoggerInformation;a.isLoggingActivated()===!0&&(logger.transports.file.level="info"),async.waterfall([this._scanNetworkInterface,this._scanCan],function(a){a&&logger.error("NetworkInterfaces: Could not scan network Interfaces: "+a)})},NetworkInterfaces.prototype._scanCan=function(a){exec("/sbin/ifconfig can0",function(b,c){if(b&&logger.error("NetworkInterfaces: Could not read can0 config: "+b),c)if(-1!==c.toUpperCase().indexOf("DEVICE NOT FOUND"))logger.error("NetworkInterfaces: CAnCape not found");else if(-1===c.toUpperCase().indexOf("RUNNING"))return logger.error("NetworkInterfaces: can0 is down"),exec("ip -details -statistics link show can0",function(a){a&&logger.error("NetworkInterfaces: Could not read can0 statistics: "+a)}),logger.error("NetworkInterfaces: Restarting can0"),exec("/sbin/ifconfig can0 down && /sbin/ifconfig can0 up"),a()})},NetworkInterfaces.prototype._scanNetworkInterface=function(a){exec("ip a show eth0 up",function(b,c){return b&&logger.error("NetworkInterfaces: Could not read eth0 status: "+b),c?a():(logger.error("NetworkInterfaces: eth0 is down"),logger.error("NetworkInterfaces: Restarting eth0"),exec("/sbin/ifconfig eth0 up"),void 0)})},module.exports=NetworkInterfaces;