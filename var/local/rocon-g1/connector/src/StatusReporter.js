var _=require("underscore"),async=require("async"),moment=require("moment"),StatusReporter=function(a,b,c,d){var e=this;_.bindAll(this),this.beagle=b,this.timeout=d,this.rccsClient=c,this.reportData={installation:null,swVersion:null,lastCanBusContact:null},async.parallel({swVersion:b.getVersion,installation:b.getId},function(a,b){e.reportData=b,e.report()}),a.addListener("onMessage",function(){e.reportData.lastCanBusContact=moment().utc().format()})};StatusReporter.prototype.report=function(){var a=this;this.rccsClient.request(JSON.stringify(this.reportData),{path:"/installation/status",method:"POST"},function(b){200!=b.statusCode&&console.warn("unable to send status: "+b.statusCode),setTimeout(a.report,a.timeout)})},module.exports=StatusReporter;