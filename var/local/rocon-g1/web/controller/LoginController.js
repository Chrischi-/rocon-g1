var _=require("underscore"),assert=require("assert"),LoginController=function(a,b){assert(b),assert(a),this.passwordGenerator=b,this.userRepository=a,_.bindAll(this)};LoginController.prototype.index=function(a,b){a.session.user?b.redirect("/web"):b.render("login")},LoginController.prototype.login=function(a,b){var c=this;this.userRepository.findOneByUsername(a.body.username,function(d,e){if(d)a.flash("error",d),b.redirect("/web/login");else{var f=c.passwordGenerator.createHash(a.body.password,e.salt);a.body.username==e.username&&f==e.password?(a.session.user=e.username,b.redirect("/web")):(a.flash("error","web.login.invalid"),b.redirect("/web/login"))}})},LoginController.prototype.logout=function(a,b){delete a.session.user,b.redirect("/")},module.exports=LoginController;